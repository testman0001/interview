## TCP/IP分层模型

应用层：定义数据格式并解读数据，ftp、smtp、dns、http

传输层：不同机器上进程间端口对端口通信，tcp、udp

网络层：处理数据分组在网络中的活动，规定数据传输路线，icmp、ip、igmp

链路层：设备驱动、网卡，对数据进行实际物理传输

## TCP

### 特点

1.面向连接的

2.可靠传输，实现方式：数据校验、确认、重传

3.双全工（双向传输数据）

速度慢、可靠性高，常用于可靠性要求较高的场景，如文件传输

### 首部信息

源地址、目的地址、序列号、确认号、数据偏移、保留位、控制位、窗口大小、校验和、紧急指针

### tcp三次握手

c--->s: syn(x)                               c(发送完syn):closed--->syn_send                                                                                   s确认c的发送，s的接收ok

s--->c:syn(y)+ack(x+1)		    s(接收到syn):closed--->syn_recvd                                                                                   c确认s的发送接收，c的发送接收ok

c--->s:ack(y+1)                           c(接收到ack):syn_send--->established s(接收到ack):syn_recvd--->established              s确认s的发送、c的接收ok

1.isn是否固定：x，y随机生成，防止攻击

2.第三次握手可以携带数据，面试常问是否能缩减到2次握手，考的就是这点，但第一次不能带，不然容易受到流量攻击

3.syn攻击：s端走到第二次握手时，因为伪造的syn源地址导致无法获取c端的确认，反复进行第二次握手操作

4.半连接队列：服务端syn_recvd阶段，此时的请求连接放到半连接队列里，防止连接请求过多导致服务器进程异常

5.第三次握手的ack丢失会怎样：s在3、6、12重新发送syn+ack，收不到直接关闭；客户端在发送数据时受到rst包断开连接

### tcp四次挥手

c--->s:fin(x)                               c: established--->fin_wait1(不再发数据)

s--->c:ack(x+1)                         s(发出ack后):established--->close_wait(半关闭状态，c--->s断开，s--->c没断)     c(接收到ack后):fin_wait2

s--->c:fin(y)                               s(发出fin后):last_ack(等待最后一个ack)

c--->s:ack(y+1)                         c(发出ack):time_wait--->closed(等待2msl自动进入) s(收到ack):closed

1.为什么第二次和第三次要分开：s端可能还有数据要发送

2.2msl是什么：2*最大报文生存周期，确保s端如果没收到ack时，c可以重发

### 滑动窗口

不需要确认即可发送的最大数据值，由接收端告知rwnd

### 拥塞机制

拥塞窗口：cwnd，发送方以此来控制发送速率（取滑动窗口和cwnd的最小值发送）

1.慢启动：从小到大指数增长拥塞窗口，起始值和系统有关，一直增长到慢启动阈值后进入拥塞避免阶段，（默认阈值65535，当出现丢包时调整成当前cwnd的一半）

2.拥塞避免：线性增加拥塞窗口（例如每次+1），直到出现丢包

3.快速重传：收到重复的ack（数据包丢失，接收方会重复ack，提示重传），立刻重新发送

4.快速恢复：收到三次重复ack，慢启动阈值直接减半，拥塞窗口减半（有的算法减半后+3），并开始进入拥塞避免阶段


## UDP

### 特点

1.无连接

2.不可靠传输

3.无序

4.速度快

5.支持组播

适用于对数据可靠性要求不高，但流量较大的应用。如视频会议、直播


## HTTP

### 错误码

1XX:   请求正在处理

2XX：请求处理完毕

3XX：需要附加操作完成请求

4XX：服务器无法处理请求

5XX：服务器处理请求出错


例如:

200：成功处理

301：网页永久移动，重定向至新地址

400：客户端请求语法错误

403：服务器收到请求但拒绝提供服务

404：服务器找不到请求网页

500：服务器内部错误，无法完成请求

### 常用请求方式

get：获取资源

post：传输更新数据

put：上传新增数据

delete：删除数据

### 长连接、短连接

HTTP/1.0中，默认使用的是短连接；HTTP/1.1起，默认使用长连接，基于tcp协议的长连接和短连接

优势：一个tcp连接可处理多个http请求，降低连接建立的资源消耗，降低连接开关带来的延迟

## 其他问题

### 访问特定域名流程

1.dns解析，浏览器dns缓存---系统dns缓存---hosts文件---dns服务器查询

2.建立tcp连接

3.发起http请求

4.服务器响应http请求，返回html资源

5.浏览器解析html并显示


### cookie和session

都是用来进行用户身份验证和状态管理的机制

1.cookie保存在客户端，session保存在服务端

2.cookie长时间保持，session一般客户端关闭或者超时都会失效

3.sessionID保存在cookie中，第二次访问服务器时，cookie将携带sessionID给服务器，标志用户身份
