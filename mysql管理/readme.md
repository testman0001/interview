设计开发的mysql管理模块，针对公司使用要求，调整mysql集群关系，后也扩展用来管理gaussdb、redis、zk

## 选主算法

### 常用分布式选举算法：

1.bully算法

成员分两种：普通节点、主节点

选举标准：id大小，每个节点保存其他节点id信息，一票否决

选举流程：1.当主节点挂了，如果当前节点id最大，则发送victory宣誓主；2.如果不是则发送election给比自己大的竞争主；3.没收到alive消息，则宣誓主，收到则等待；4.收到election则对比id，如果自己更大则发alive，拒绝

2.raft算法

成员：leader，follower，candidate

选举标准：超过半数通过

选举流程：1.节点以follower启动，一段时间没收到leader消息转为candidate；2.发送投票请求，包含用于选举的信息；3.其他节点响应；4.超过半数同意则成为leader，否则继续选举

### 管理模块的选举算法

基于raft+bully算法的改造版本，同时适用于2个及以下的节点数目

成员：master，slave，candidate

选举标准：按照申请时间，一票否决制

选举流程：1.节点以slave启动，一段时间没收到master消息则转为candidate；2.发送选主请求给其他节点；3.slave收到选主请求不处理，candidate及master收到请求后对比时间，如果自己更早则回应reject；4.收到任意一个reject则降级回slave，没收到则成为master

为什么要这样设计：1.环境存在两个节点及以下环境，不适用于raft少数服从多数的选举策略；2.bully算法按照全局的id大小选主可能导致主从频繁变更，因此改变选主标准，网络分区或者恢复时不会过快进行主从变更，3.引入candidate阶段过渡，让节点身份更明确

## 管理逻辑

mysql是从一主多从的集群，使用gtid（全局事务id）进行数据同步，主从由管理模块决定，由于视频业务特殊性，优先保证ap，一致性优先级比较低。最重要的是保证主从复制能进行下去，尽快提供访问，而不是做全量同步。

mysql选主标准：

gtid及启动时间


特殊处理：

1.临时双主以同步

2.当gtid存在孔洞，用空事务填充

3.在设置主从前先用空事务填充已purged的事务


## 其他

提供restful api（flask+gunicorn）
